<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">


<dom-module id="contact-list" attributes="selectedContact">
    <style></style>

    <template>
        <iron-ajax
            auto 
            url={{_url}}
            handle-as="json"
            last-response="{{contacts}}"></iron-ajax>

        <vaadin-grid items="{{contacts}}" id="grid">
            <table>
                <colgroup>
                    <col name="name">
                    <col name="email">
                </colgroup>
            </table>
        </vaadin-grid>
    </template>

    <script>
        Polymer({
            is: 'contact-list',

            properties: {
                endpoint: {
                    type: String,
                    value: '../../api'
                },
                contacts: {
                    type: Array,
                    observer: '_updateItems'
                },
                selected: {
                    type: Object,
                    notify: true,
                    value: {}
                },
                _url: {
                    type: String,
                    computed: '_buildURL(endpoint)'
                },
            },

            ready: function(){
                var grid = this.$.grid;
                var self = this;
                grid.addEventListener('selected-items-changed', function(){
                    var index = this.selection.selected();
                    if (index == ''){
                        return;
                    }
                    self.selected = this.items[index];
                    self.notifyPath('selected.name');
                });
            },

            _buildURL: function(endpoint){
                return endpoint + '/contact';
            },

            _updateItems: function(contacts){
                var grid = this.$.grid;

                grid.items = this.contacts;
                grid.refreshItems();
                
            }
        });
    </script>
</dom-module>